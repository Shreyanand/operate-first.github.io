{"componentChunkName":"component---src-templates-markdown-js","path":"/data-science/data-science-workflows/docs/create_and_deploy_jh_image.md","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"markdownRemark":{"id":"9db0a6c4-f5cd-51c2-9394-4f480af8935c","html":"<h1 id=\"how-to-create-a-jupyterhub-image-and-deploy-it-on-odh\" style=\"position:relative;\"><a href=\"#how-to-create-a-jupyterhub-image-and-deploy-it-on-odh\" aria-label=\"how to create a jupyterhub image and deploy it on odh permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to create a Jupyterhub image and deploy it on ODH</h1>\n<p>This howto is about getting your repository built into an image and having that image made available in (your) Jupyterhub instance.</p>\n<p>We are going to deal with 2 issues:</p>\n<ol class=\"pf-c-list\">\n<li>Build an image and add to a public image repository.</li>\n<li>Add your image to an ODH instance (that has a Jupyterhub in it).</li>\n</ol>\n<p>If you don’t have an ODH instance that you would like to work with, you can create one using these guides:</p>\n<p><a href=\"https://github.com/operate-first/continuous-deployment/tree/master/docs\">https://github.com/operate-first/continuous-deployment/tree/master/docs</a></p>\n<h2 id=\"build-an-image\" style=\"position:relative;\"><a href=\"#build-an-image\" aria-label=\"build an image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Build an image</h2>\n<p>If your image is not yet built, you can use <a href=\"https://thoth-station.ninja/\">Thoth</a> to do it for you using a config file in your repo.</p>\n<p>Here’s an example that goes together with the above example of an ImageStream:</p>\n<p><a href=\"https://github.com/aicoe-aiops/categorical-encoding/blob/master/.aicoe-ci.yaml\">https://github.com/aicoe-aiops/categorical-encoding/blob/master/.aicoe-ci.yaml</a></p>\n<p>I am going to compile this into a guide and would be grateful for your testing of the process or improvement suggestions.</p>\n<p>Information on enabling Thoth on your repo is here: <a href=\"https://github.com/AICoE/aicoe-ci#setting-aicoe-ci-on-github-organizationrepository\">https://github.com/AICoE/aicoe-ci#setting-aicoe-ci-on-github-organizationrepository</a></p>\n<p>For 3rd party projects outside of the AICoE, one should change the value of <code class=\"language-text\">registry-org</code> (quay.io org) to his own value.</p>\n<h3 id=\"steps-to-have-your-notebook-repo-build-into-an-image-by-thoth\" style=\"position:relative;\"><a href=\"#steps-to-have-your-notebook-repo-build-into-an-image-by-thoth\" aria-label=\"steps to have your notebook repo build into an image by thoth permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Steps to have your notebook repo build into an image by Thoth</h3>\n<h3 id=\"enable-the-ci-integration\" style=\"position:relative;\"><a href=\"#enable-the-ci-integration\" aria-label=\"enable the ci integration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enable the CI integration</h3>\n<p>To get image built by Thoth (in Tekton?) (not sure what is the right formulation here) and uploaded to quay.io (image registry) one needs to add the “aicoe-ci” app to the project:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/10362bbf2384a424764e557def3ac094/1790f/ci-integration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB+ElEQVQoz31S7W7TMBTtWyC+RunarGvHACEhMfGbbWW0o123AkMVSLwsP3kAENCxpEnz4dqOnTgxx25VwSg7ipzr+J57z7lO5cnTveaDx43t3Wp9+9bG5p1qo9F+6DR3NrfaTmu33tzZqDk3bldv3q3VnHbVad2vN+/V21utR8/2nlfGHz/1T9/2TkaHr17vv+x1uoPhm/eD42H/ZHT2bjwcnXf7pwdHvYOjY5zud7ovOt3D3rA3ODsff6hkWU5JfPHz+6Xr8TSVaRp/++pNJtSbSs6FlDLL7aMWgUFmwBiraK1NRKm2KIpCUsqjiBOSCsEYZyKbcxlTybJSlXoFsAw5VyqKYmxMnCvKOeM8FRABuhB2EWmKuvoPQJMl53kQBJQyxNDpB0Ecx0gty3Kx6nVYkmGEEIISyFOFSgiZzykWfEwsMBelFBKUMrUW5Zay8Zr6Pk95YQHNUGGVGuEcLmDdrthfJaNkGIaUMXyFmCiKiOlMrphcL1tmmet6zJJBQBMw0VlZlH/jn4EpFUYRnGttTnFTmBmESIPsf51Rd+n516Ur7VVhugkT2F78mAghr5GNPoasioKuhqFLmcRk6vM4EUlSwAvyFpLWkjPj2Z2FYW6U65ILMQvpbEY8r2Rs9eetJ8NznCSYEOIpn332v3DKlS10DVDuN+QLFPIqHrTZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Setting up CI integration with Thoth\"\n        title=\"Setting up CI integration with Thoth\"\n        src=\"/static/10362bbf2384a424764e557def3ac094/fcda8/ci-integration.png\"\n        srcset=\"/static/10362bbf2384a424764e557def3ac094/12f09/ci-integration.png 148w,\n/static/10362bbf2384a424764e557def3ac094/e4a3f/ci-integration.png 295w,\n/static/10362bbf2384a424764e557def3ac094/fcda8/ci-integration.png 590w,\n/static/10362bbf2384a424764e557def3ac094/efc66/ci-integration.png 885w,\n/static/10362bbf2384a424764e557def3ac094/c83ae/ci-integration.png 1180w,\n/static/10362bbf2384a424764e557def3ac094/1790f/ci-integration.png 1189w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>If your project is under the <code class=\"language-text\">aicoe-aiops</code> (and some other) GH orgs then this is already done on the org level and you don’t need to do this step.</p>\n<h3 id=\"setting-up-the-image-repository\" style=\"position:relative;\"><a href=\"#setting-up-the-image-repository\" aria-label=\"setting up the image repository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting up the image repository</h3>\n<p>Next you need to have a place to upload the built images. For that you need an account and a project on quay.io.</p>\n<p>Again there already exists an ‘AICoE’ organization in Quay: <a href=\"https://quay.io/organization/aicoe\">https://quay.io/organization/aicoe</a> so if your project is part of AICoE you can use that.</p>\n<p>Thoth needs to be able to access your project — push images into it. That can be accomplished by creating a robot account with a push (pull) secret.</p>\n<p>There are pre-configured push secrets for various projects already present in Thoth. See the bottom of this page: <a href=\"https://github.com/AICoE/aicoe-ci#services-and-features\">https://github.com/AICoE/aicoe-ci#services-and-features</a>.</p>\n<p>If your project is in one of these, you can skip this step.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/48ca3/quay-robot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAByklEQVQoz3WRW4vaQBTH8zFt3ILQGlehX8ALbT/Flgrbl2zACyR5sK1uEncLbe1qk/iyWBRE9yEXpGucyWVysyex9GGhPyZ/hn/mnDnnDCXywuDjp+FwdHP75VqSx+MbSZaHo2tJkj8PwR7JyliSldlP9etkoijKYDAQBXE6nX6f/KBWvxbbhwfbtn3fxxif1HEc13VBEULgHA6HOI5CQgzT2qzXi/t7zw+SJKGe5RQKBdAiTcOmWKRf1aq1Wo1hmGq1CkrTNPw6O3t+XmEq5Rfn5ZcVplwqlah2u82y7FUOx3GdTqfb7YoCz/OCKGTADpxer9fv9y/ZzsUH7uKSY7t8FhwGQRiGURTFOcf/kKYpqLz4/f52+05Zf9uSt29eU2iz8RGybHu324EahmEBpmmYJigAnUPPGKEDQp7r+i529o+QqNVqUY5lxWGYZqkzkvQpp5uhNEIIlAgOVAlOs9mklqtVEBDXJ9j1PS9IoiiJYzgBLcBpUJgqIQEA8TD5IG8TghuNBgU1Bq6bPO6PCEcIh3ucYu9JwyQ5xnkFeSJyGk29XqckSZrNZnNVnd/d6dma6po2/4c+13Vdg0//a2iapqrqcrmEt/wDTBvqkGWal+EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Quay pull secret setup\"\n        title=\"Quay pull secret setup\"\n        src=\"/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/fcda8/quay-robot.png\"\n        srcset=\"/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/12f09/quay-robot.png 148w,\n/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/e4a3f/quay-robot.png 295w,\n/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/fcda8/quay-robot.png 590w,\n/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/efc66/quay-robot.png 885w,\n/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/48ca3/quay-robot.png 1084w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>After creating the robot you need to set the permissions it will possess.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3a6e2c9ee1a48338dbf0e809b91590f5/e3829/quay-secret.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.45945945945947%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACbElEQVQ4y4VT2U7bQBT1F1YVTVmUDduBkEClCn6j6SegVDKr6rbqQ595QGpCydJKwaYVEUqzKE68xYMdz9iTXo9DgUrQo5E9Y82599x7rrl0hhdy69lVMZVeXV5JvUgsRuvlUmJxOV4LicVnzxdW+dx6cUsobuTXNxJLK/l84VVxk7tWLn6qaqfT0TTNdV3LthFCE9O0DWNq2f5Y903LMU1nMiFBYOj6YDC4vLgwDQMTwuVEcY0hmUymUilREF7ncjuFQlEUt9bWCjwPz+3NzR3IxfOZbDadTsO1TCYjCAL3plTa3d2VJKlcLr9jkA8OPh0dyXt7siS9lyTYfNjf/3x8LB8eHh5FgLcsy29LJU5VVdAZhiGNMAsC2IazJxFfaLVaXKVS6Xa7nudBwXYEyzJNWME9RPHgRUh8xBgDuVarcfV6XRsO4YJu6I7reT6hsxl9mMr1CQ4C9h3E0Thzo9Hgms3meDyGqNBHZE08GxHXoyz2HJQi28YIzW7LuSNXq9Vevx9Mpze9nm/o2EFI04lhMhaNsmGMBl2saVNkIXzjB/4dOZKtaYQQ8G0KnfM8SkjIwseAIm3XwZgounry++TKvIrzA5E7Pz8fDofY90E5dDyMs1H6325H5Ha7DbF937csC8YI+gwq/rlNH+IBGQ6g2TCM0WjU7/fBdnDuMbeBDNbMrVIvL8FhsA6+RskdJ6qfHZ+WHZEVRblBCGTfH4nHaEFIv18bZ79GysCtnH1jZAYTfh0Hqp7AlP2NRW6nCjZQLA7Cj2edg9P2lx/a6dfqnIxvpwLUElY/+KczwAjBE9oBRbEQ84aBTX8A2Jl0c/6Pa8wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Quay: setup permissions\"\n        title=\"Quay: setup permissions\"\n        src=\"/static/3a6e2c9ee1a48338dbf0e809b91590f5/fcda8/quay-secret.png\"\n        srcset=\"/static/3a6e2c9ee1a48338dbf0e809b91590f5/12f09/quay-secret.png 148w,\n/static/3a6e2c9ee1a48338dbf0e809b91590f5/e4a3f/quay-secret.png 295w,\n/static/3a6e2c9ee1a48338dbf0e809b91590f5/fcda8/quay-secret.png 590w,\n/static/3a6e2c9ee1a48338dbf0e809b91590f5/efc66/quay-secret.png 885w,\n/static/3a6e2c9ee1a48338dbf0e809b91590f5/e3829/quay-secret.png 1077w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>And finally, you need to copy the secret and give it to Thoth. Copy the secret here:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3a6e2c9ee1a48338dbf0e809b91590f5/e3829/quay-secret.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.45945945945947%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACbElEQVQ4y4VT2U7bQBT1F1YVTVmUDduBkEClCn6j6SegVDKr6rbqQ595QGpCydJKwaYVEUqzKE68xYMdz9iTXo9DgUrQo5E9Y82599x7rrl0hhdy69lVMZVeXV5JvUgsRuvlUmJxOV4LicVnzxdW+dx6cUsobuTXNxJLK/l84VVxk7tWLn6qaqfT0TTNdV3LthFCE9O0DWNq2f5Y903LMU1nMiFBYOj6YDC4vLgwDQMTwuVEcY0hmUymUilREF7ncjuFQlEUt9bWCjwPz+3NzR3IxfOZbDadTsO1TCYjCAL3plTa3d2VJKlcLr9jkA8OPh0dyXt7siS9lyTYfNjf/3x8LB8eHh5FgLcsy29LJU5VVdAZhiGNMAsC2IazJxFfaLVaXKVS6Xa7nudBwXYEyzJNWME9RPHgRUh8xBgDuVarcfV6XRsO4YJu6I7reT6hsxl9mMr1CQ4C9h3E0Thzo9Hgms3meDyGqNBHZE08GxHXoyz2HJQi28YIzW7LuSNXq9Vevx9Mpze9nm/o2EFI04lhMhaNsmGMBl2saVNkIXzjB/4dOZKtaYQQ8G0KnfM8SkjIwseAIm3XwZgounry++TKvIrzA5E7Pz8fDofY90E5dDyMs1H6325H5Ha7DbF937csC8YI+gwq/rlNH+IBGQ6g2TCM0WjU7/fBdnDuMbeBDNbMrVIvL8FhsA6+RskdJ6qfHZ+WHZEVRblBCGTfH4nHaEFIv18bZ79GysCtnH1jZAYTfh0Hqp7AlP2NRW6nCjZQLA7Cj2edg9P2lx/a6dfqnIxvpwLUElY/+KczwAjBE9oBRbEQ84aBTX8A2Jl0c/6Pa8wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"quay-robot-2\"\n        title=\"quay-robot-2\"\n        src=\"/static/3a6e2c9ee1a48338dbf0e809b91590f5/fcda8/quay-secret.png\"\n        srcset=\"/static/3a6e2c9ee1a48338dbf0e809b91590f5/12f09/quay-secret.png 148w,\n/static/3a6e2c9ee1a48338dbf0e809b91590f5/e4a3f/quay-secret.png 295w,\n/static/3a6e2c9ee1a48338dbf0e809b91590f5/fcda8/quay-secret.png 590w,\n/static/3a6e2c9ee1a48338dbf0e809b91590f5/efc66/quay-secret.png 885w,\n/static/3a6e2c9ee1a48338dbf0e809b91590f5/e3829/quay-secret.png 1077w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>This is currently a manual process so just, please, send the secret (the whole yaml) to @harshad16 to have it added.</p>\n<p>Remember, this is only if you actually need new push secret. That is if Thoth does not have it already preconfigured.</p>\n<h3 id=\"adding-configuration-file-to-your-repo\" style=\"position:relative;\"><a href=\"#adding-configuration-file-to-your-repo\" aria-label=\"adding configuration file to your repo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding configuration file to your repo</h3>\n<p>Next we need to finish configuration of the source repo. This is done by adding a config file named <code class=\"language-text\">.aicoe-ci.yaml</code>.</p>\n<p>Here’s an example of a working minimal config: <a href=\"https://github.com/aicoe-aiops/project-template/blob/master/.aicoe-ci.yaml\">https://github.com/aicoe-aiops/project-template/blob/master/.aicoe-ci.yaml</a></p>\n<p>Uncomment the <code class=\"language-text\">build</code> section to enable Thoth build.</p>\n<p>The builder can do a number of things. To have the S2I correctly build these 2 lines are essential:</p>\n<p>The important parts for building the image using S2I into a format expected by JH is:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  build-source-script: &quot;image:///opt/app-root/builder&quot;\n  base-image: quay.io/thoth-station/s2i-custom-notebook:latest</code></pre></div>\n<p>Modify the lines in the <code class=\"language-text\">build</code> section:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  registry-org: aicoe\n  registry-project: my_project\n  registry-secret: aicoe-pusher-secret</code></pre></div>\n<p>to match the project and robot’s push secret you have setup in Quay.</p>\n<h3 id=\"triggering-the-build\" style=\"position:relative;\"><a href=\"#triggering-the-build\" aria-label=\"triggering the build permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Triggering the build</h3>\n<p>Once you have this in your repo. You can trigger the build by doing a release. This is something that will be done for you automatically if you are using the whole Thoth toolset. But for minimal working setup, you can create a release manually.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ea86315a74ee37b4084253357c84c241/84bf8/gh-tag.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACMklEQVQoz1VRy04UQRTt33BhIg7MMIERJSFGE3/QpRBgeAgDCPED3PsDLjRxoSwkKjI9013v6np2t6cGQTipVOpW39vnUdnzl69W114sLq10+4POwuKjTq/TW+r2n8zN9zvdJZznFvoPHj7GoTd41l1e6fUH8/2V5adrq6tr2f7odHhwtr4zWh+OXq/vbwwPR8fvTk7fj07OsGMdnZztvh1tDvfebG5vDfc2tna2dw+3dw8ODo8ybYPyrfKNDg21bRVaoG6aukl7096gaZvY4sKHOKsSMsmI5rSSwghuOJOEWGt1pY0xUikplVa6YOTL+Nv55AfnqHWs6xBr61wmVSWU4YSJy7G4yh3hM842Nq3xkSujtLti5Pjrh4+/Pil0VxX+jj2EkE1KdpmTiz/FmOqpsESHQthSeW5qLKJ8KV26oU6bGrRCiDRsDCxkCsxSlYRyLrSulNIlZZRx53yM9fUKIeIzBhS6jbnNIYM31IxxQtHArXVCSi6k8z4FM0Ndg7PCjVRyXE5s9P+GkxIpp9OiLAkhFCVUFCVic7fDIGc8qXWxtaG5xwxgXgiptUYDSJAp8mjuAJM+hPR7ypr0UmklZsb5OM8n00ICWhdFCR14ifYOYATutKuRn3bxhtkmZnjmAiE5k5iTEe/DjeoEYxKz5FSQog22cVUTPdLWyBaUMUZITZ4pCzEipbuywQxHOv+Zf//Mf5+7/KJWNKtmhilj10pQ4uzc/7SugVd0940AfwF/9ePv1q8EZAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Trigger a build in GH\"\n        title=\"Trigger a build in GH\"\n        src=\"/static/ea86315a74ee37b4084253357c84c241/fcda8/gh-tag.png\"\n        srcset=\"/static/ea86315a74ee37b4084253357c84c241/12f09/gh-tag.png 148w,\n/static/ea86315a74ee37b4084253357c84c241/e4a3f/gh-tag.png 295w,\n/static/ea86315a74ee37b4084253357c84c241/fcda8/gh-tag.png 590w,\n/static/ea86315a74ee37b4084253357c84c241/efc66/gh-tag.png 885w,\n/static/ea86315a74ee37b4084253357c84c241/84bf8/gh-tag.png 1162w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b7206769cf0cf5061917d06278daf362/d74fe/gh-release.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB7ElEQVQoz5VS227TQBDd30BCAtokbkIgQAqV+CneUAsppuQqDAh+gI/gkS8pAiEaBztJbSfxbe82x3EVqpAXRkezntk5M+PZIYdHTx8dHjWaLaPe3K8Yt/aqlVqjdtCsGHerB829av32vnHj5p1a/V691TYQ1rhfbTxoPXzcbj8hfetjp/fu2Bw+fzV4dtx9YQ76I2v49n1vaA2tD0BvZJndwUvzzUnH7Jjdk9PXnbPB6Vmv2x8RJmQqVMx1SLWf6JipLMul1jrLpCo0BBqfjAvYXMg8z5XOEUZ+/Jyff3eXy5Bzxmgax3FKWZwkSUrjFEILM05SRuGCB1dCCKTgQpDPX51PXyZj20c+JPsvIcyZCHciGI+ieLFYLlehkEIplf2V/OrIc9edjm37Ymx7flCQnfNfzrcLf0W9iHsh9ULmAxEXakcbs9n8t+MCIKMACRdhtIoSWkRLnW+gd/1DEASXnudDgkBKSVLGitkkqYCl1AZCbgPXZWXo6XSGsRF+NTp1Hf8yS0zX4jiO53mYAlnX0VvYyYR/drmwnTlqo3/8F8Ezlm3jfRPKYFLKrnM4ULQmKbZE5VxhHJun4gLeFEtAOVKsVlEY4aTwlHqTApElJ1ujJCNpsYhYPQQxhkXjKE7XSQGldAmtt+f/B3vn4Tg75ygAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Do a release in GH\"\n        title=\"Do a release in GH\"\n        src=\"/static/b7206769cf0cf5061917d06278daf362/fcda8/gh-release.png\"\n        srcset=\"/static/b7206769cf0cf5061917d06278daf362/12f09/gh-release.png 148w,\n/static/b7206769cf0cf5061917d06278daf362/e4a3f/gh-release.png 295w,\n/static/b7206769cf0cf5061917d06278daf362/fcda8/gh-release.png 590w,\n/static/b7206769cf0cf5061917d06278daf362/efc66/gh-release.png 885w,\n/static/b7206769cf0cf5061917d06278daf362/d74fe/gh-release.png 1164w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>If you have done these steps correctly, Thoth will pick up your tag and run a image build for you.</p>\n<h2 id=\"checking-and-debugging-the-build\" style=\"position:relative;\"><a href=\"#checking-and-debugging-the-build\" aria-label=\"checking and debugging the build permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Checking and debugging the build</h2>\n<p>You can login to <a href=\"https://tekton-dashboard-openshift-pipelines.apps.ocp4.prod.psi.redhat.com/\">https://tekton-dashboard-openshift-pipelines.apps.ocp4.prod.psi.redhat.com/</a> and find your build by using the search field. Enter “project:&#x3C;YOUR<em>REPO</em>NAME>“.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ed3d625fec1d7e4acb5615b02f04b61f/19a6b/thoth-pipeline-run.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.51351351351351%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABsklEQVQoz51SXU/UQBSdP8N2V3hg/TH+FRXYLu4+mfhLfCOQ8G5CSAjRgEGh7nYhui277XSmnc9O28E7bWKU6AOenNyc0+npvb0tGg6fb28Pez2v5+D1+4OBN/DAbvQ6bLTwPDh45g77fSBgc2sLvW0xmUym0+neaPzy9c6rnd3dke+P34z8fSAIp8f7eyMfbgDhOz2Gi0gpVVXVQwtTNQlVKVVMNWDtn+zQ6aYl+jYL5/MZxpgS8n2VX55dfPpwGny8iu9WccrjhD1ilLA1ZpyxjBRISmmM6Z4a3ScHh8eHR8eLH0mhHrhqYASuLddNSwtWGRuR5uDcnlw3qCgKyHdhqUzOJeOSkjzB2WqdZll+v8brFKcpAZvinBJ8fkNevCsm75nr/CtMMFl8/RJ8vrm9Dpfh7VVwt4yT+WwWBEG0XLoaRYswXIRzmsYFxUgIkWWZ1hrCQhrBZJFxCm+VCyLqXBihDJdlRyY0WKhMgDXIrYpSt3BrZVkzVXNdC91WVfHHrH+rFSKEQGeYvCxLqSv2l8A/iRhjnHNIwveDMH9SmLew1v0FUtdP6wwzw87+L/wT+byX73luqBgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Tekton: search a build\"\n        title=\"Tekton: search a build\"\n        src=\"/static/ed3d625fec1d7e4acb5615b02f04b61f/fcda8/thoth-pipeline-run.png\"\n        srcset=\"/static/ed3d625fec1d7e4acb5615b02f04b61f/12f09/thoth-pipeline-run.png 148w,\n/static/ed3d625fec1d7e4acb5615b02f04b61f/e4a3f/thoth-pipeline-run.png 295w,\n/static/ed3d625fec1d7e4acb5615b02f04b61f/fcda8/thoth-pipeline-run.png 590w,\n/static/ed3d625fec1d7e4acb5615b02f04b61f/efc66/thoth-pipeline-run.png 885w,\n/static/ed3d625fec1d7e4acb5615b02f04b61f/c83ae/thoth-pipeline-run.png 1180w,\n/static/ed3d625fec1d7e4acb5615b02f04b61f/19a6b/thoth-pipeline-run.png 1191w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The part that is relevant for image building is under “tag-release-run”. There may by other sections that are red, but if this part is green the image was built and pushed. You can also check that on Quay.io.</p>\n<h1 id=\"adding-the-image-where-you-need-it\" style=\"position:relative;\"><a href=\"#adding-the-image-where-you-need-it\" aria-label=\"adding the image where you need it permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding the image where you need it</h1>\n<p>Once your image is built (check in Quay), you can use it in your instance of ODH.</p>\n<h2 id=\"creating-an-imagestream\" style=\"position:relative;\"><a href=\"#creating-an-imagestream\" aria-label=\"creating an imagestream permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating an ImageStream</h2>\n<p>This is done using a manifest of type <code class=\"language-text\">ImageStream</code>.</p>\n<p>Here is an example:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> image.openshift.io/v1\n  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ImageStream\n  <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> categorical<span class=\"token punctuation\">-</span>encoding<span class=\"token punctuation\">-</span>notebook\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">opendatahub.io/notebook-image</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span>\n  <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">lookupPolicy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">from</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> DockerImage\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> quay.io/aicoe/categorical<span class=\"token punctuation\">-</span>encoding<span class=\"token punctuation\">:</span>latest\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> latest\n        <span class=\"token key atrule\">importPolicy</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">scheduled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>The important part is:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  labels:\n    opendatahub.io/notebook-image: &quot;true&quot;</code></pre></div>\n<p>This tells JupyterHub that it has to offer this particular image then creating an instance for it’s users.</p>\n<p>Depending on where you want to use your image, you have to place the manifest into the right place or load in into your project using <code class=\"language-text\">oc apply -f &lt;image_file.yaml&gt;</code>.</p>\n<p>For example</p>\n<ul class=\"pf-c-list\">\n<li>If you want to add your image to MOC, make a PR such as this one: <a href=\"https://github.com/operate-first/odh/pull/25\">https://github.com/operate-first/odh/pull/25</a></li>\n<li>If you need to add your image to the DH (ODH instance run by DH team), make a PR against the <code class=\"language-text\">production</code> branch here:\n<a href=\"https://github.com/AICoE/idh-manifests/blob/production/jupyterhub/bases/custom-images/jupyterhub-custom-images.yaml\">https://github.com/AICoE/idh-manifests/blob/production/jupyterhub/bases/custom-images/jupyterhub-custom-images.yaml</a></li>\n</ul>","fields":{"srcLink":"https://github.com/aicoe-aiops/data-science-workflows/blob/master/docs/create_and_deploy_jh_image.md"},"frontmatter":{"title":"","description":null}}},"pageContext":{"id":"9db0a6c4-f5cd-51c2-9394-4f480af8935c"}},"staticQueryHashes":["117426894","3000541721"]}